<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>ÙØ§Ø­Øµ Appwrite - Diagnostic Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 2rem;
        }

        .card {
            background: #2a2a2a;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border: 1px solid #444;
        }

        .success {
            color: #00ff00;
        }

        .error {
            color: #ff4444;
        }

        .warning {
            color: #ffaa00;
        }

        pre {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            color: #0f0;
            font-size: 0.8rem;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
            background: #e91e63;
            color: white;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <h1>ğŸ” ÙØ§Ø­Øµ Ø§ØªØµØ§Ù„ Appwrite</h1>
    <p>Ø§Ù„Ø£Ø¯Ø§Ø© Ø¯ÙŠ Ù‡ØªÙØ­Øµ ÙƒÙ„ Ø­Ø§Ø¬Ø© ÙÙŠ Appwrite Ø¹Ø´Ø§Ù† Ù†Ø¹Ø±Ù Ù„ÙŠÙ‡ Ø§Ù„Ø­ÙØ¸ Ù…Ø´ Ø´ØºØ§Ù„.</p>

    <button onclick="runDiagnostics()">Ø¨Ø¯Ø£ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¢Ù† ğŸš€</button>

    <div id="results"></div>

    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
    <script src="js/appwrite-config.js"></script>
    <script>
        async function runDiagnostics() {
            const results = document.getElementById('results');
            results.innerHTML = '';

            function log(title, status, details = '') {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <h3 class="${status}">${title}</h3>
                    ${details ? `<pre>${details}</pre>` : ''}
                `;
                results.appendChild(div);
            }

            const { client, databases, DB_ID, COLLECTIONS } = window.appwrite;

            // 1. Check Configuration
            log('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„', 'success',
                `Endpoint: ${client.config.endpoint}\nProject ID: ${client.config.project}\nDatabase ID: ${DB_ID}`);

            // 2. Check Database Access (Smoke Test)
            try {
                // Try listing documents to check connectivity
                const docs = await databases.listDocuments(DB_ID, COLLECTIONS.MATERIALS, [Appwrite.Query.limit(1)]);
                log('Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success', `ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­. Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚: ${docs.total}`);
            } catch (e) {
                log('Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error', `ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø©: ${e.message}\n(ÙƒÙˆØ¯ Ø§Ù„Ø®Ø·Ø£: ${e.code || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'})`);
                if (e.message.includes('fetch')) {
                    log('ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨', 'error', 'ØºØ§Ù„Ø¨Ø§Ù‹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù‡ÙŠ CORS Ù„Ø£Ù†Ùƒ Ø¨ØªÙØªØ­ Ø§Ù„Ù…Ù„Ù Ù…Ù† file://.\nØ¬Ø±Ø¨ ØªØ´ØºÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù€ Live Server.');
                }
            }

            // 3. Check Collections Availability
            const cols = ['MATERIALS', 'USERS', 'LOGS'];
            for (const colKey of cols) {
                const colId = COLLECTIONS[colKey];
                try {
                    await databases.listDocuments(DB_ID, colId, [Appwrite.Query.limit(1)]);
                    log(`Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù† ${colKey}`, 'success', `Ø§Ù„Ù…Ø¹Ø±Ù: ${colId}\nØ§Ù„Ø­Ø§Ù„Ø©: Ù…ØªØ§Ø­ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ù†Ø¬Ø§Ø­.`);
                } catch (e) {
                    if (e.code === 404) {
                        log(`Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù† ${colKey}`, 'error', `ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯! ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆÙ„ÙŠÙƒØ´Ù† Ø¨Ù€ ID: ${colId}`);
                    } else if (e.code === 401 || e.code === 403) {
                        log(`Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù† ${colKey}`, 'warning', `Ù…ÙˆØ¬ÙˆØ¯ ÙˆÙ„ÙƒÙ† Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.\nÙ„Ø§Ø²Ù… ØªØ±ÙˆØ­ Appwrite -> Collection -> Settings -> Permissions ÙˆØªØ¶ÙŠÙ "Any" ÙˆØªÙØ¹Ù„ Read.`);
                    } else if (e.message.includes('fetch')) {
                        // Already logged above
                    } else {
                        log(`Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù† ${colKey}`, 'error', `Ø®Ø·Ø£: ${e.message}`);
                    }
                }
            }
        }
    </script>
</body>

</html>